---
matrix:
  platform:
    - ubuntu2004
    - ubuntu2204
    - macos_arm64
    - windows
  bazel:
    - 6.x
    - 7.x
    - 8.x

.reusable_build_flags: &reusable_build_flags
  ? "--incompatible_config_setting_private_default_visibility"
  ? "--incompatible_disallow_empty_glob"

.reusable_test_flags: &reusable_test_flags
  <<: *reusable_build_flags
  ? "--test_env=PATH"

.reusable_targets: &reusable_targets
  ? "--"
  ? "//..."
  ? "@external_directory_tests//..."
  ? "@bazel_skylib_gazelle_plugin//..."

.reusable_config: &reusable_config
  build_flags: *reusable_build_flags
  test_flags: *reusable_test_flags
  build_targets: *reusable_targets
  test_targets: *reusable_targets

tasks:
  run_presubmit:
    <<: *reusable_config
    name: ${{ bazel }}
    platform: ${{ platform }}
    bazel: ${{ bazel }}


buildifier: latest
